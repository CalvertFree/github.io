Week 08
=======

The Week 08 Assignment:

- <http://elvenware.com/charlie/books/CloudNotes/Prog282/Week08-Assignment.html>

Merging Git Files:

- <http://elvenware.com/charlie/development/cloud/Git.html#merging-code>

CouchDb Attachments
-------------------

We often want to add attachments such as an HTML document or image file
to our CouchDb database.

<http://wiki.apache.org/couchdb/HTTP_Document_API#Attachments>

~~~~
app.get("/attachHtml", function(request, response) {'use strict';
   console.log('/attachHtml called');
   
   var fs = require('fs');

    fs.readFile(__dirname + '/Templates/Basic.html', function(err, data) {
        if (!err) {
            var prog = nano.db.use(dbName);
            prog.attachment.insert('basic', 'basic.html', data, 'text/html',
                function(err1, body) {
                if (!err1) {
                    console.log(body);
                } else {
                    console.log(err1);
                    response.send(500, err1);
                }
            });
        } else {
            console.log(err);
            response.send(500, err);
        }
    }); 
});
~~~~

Sending Back Express and Nano Errors
-----------------------------------

Send a 500 (Internal Server Error) HTTP Error code:

~~~~
	function(err, body) {
        if (!err) {
            console.log(body);
            response.send(body);
        } else {
            var cscMessage = "No such record as: " + request.query.docName +
                ". Use a the Get Doc Names button to find " +
                "the name of an existing document."
            err.p282special = cscMessage;
        	response.send(500, err);
        }
    }
~~~~

All that needs to be done is send the error code as the first parameter
to response.send:

	response.send(500, err);
	
Here is more information on HTTP code. As you can see, some are error
codes, some -- such as 200 -- signify success. Your code (and many other
tools) can decide what to do with an HTTP message depending on the 
code that is send with it:



Note also that I am adding a special field onto the error message. This
allows me to send back custom error messages along with any details
generated by the Nano error message system.

One the client side we do this:

~~~~
	var create = function() {
        $.ajax({
            type : 'GET',
            url : '/create',
            dataType : 'json',
            success : function(data) {
                showDebug(data.Result);
            },
            error : showNanoError
        });
    };

    var showNanoError = function(request, ajaxOptions, thrownError) {
        var responseText = JSON.parse(request.responseText);
        if (typeof responseText.p282special !== 'undefined') {
            showDebug(responseText.p282special);
        }
        showDebug(responseText.message);
        showError(request, ajaxOptions, thrownError);
    };
~~~~

Notice that I have create a special error handler for this kind of
message. By sending back a 500 HTTP Error Code we ensure that our
error handler will be called. The **showNanoError** has special 
processing for Nano messages, then we pass the whole error onto our
regular Prog282 error handler. As you recall, it looks like this:

~~~~
    var showError = function(request, ajaxOptions, thrownError) {
        showDebug("Error occurred: = " + ajaxOptions + " " + thrownError);
        showDebug(request.status);
        showDebug(request.statusText);
        showDebug(request.getAllResponseHeaders());
        showDebug(request.responseText);
    };
~~~~

Clear there are ways to streamline this process, but even if it is 
overkill, it is nonetheless likely to give you good error support during
the development process.

Constants
---------

JsObjects/JavaScript/Properties/Constants01

CouchApp Pages
--------------

http://couchapp.org/page/pages-install
https://github.com/couchapp/couchapp

ez_setup.py
distribute_setup.py
set VS90COMNTOOLS=%VS110COMNTOOLS%
python-2.7.5.msi
pywin32-218.win32-py2.7.exe
py2exe-0.6.9.win32-py2.7.exe

couchapp init  
couchapp push . http://localhost:5984/pages

Erica
-----

	<https://github.com/benoitc/erica>

Install erica:
	
	git clone git://github.com/benoitc/erica.git
	sudo apt-get install erlang

Or, if you want to get into erlang, do this:

	sudo apt-get install erlang erlang-doc

Then create something

	erica create-webapp
	cd myapp
	erica push http://192.168.2.18:5984/myapp

Create an app called bar:

	erica create-webapp appid=bar
	cd bar
	erica push http://192.168.2.18:5984/bar

Git Merge
---------

- <http://elvenware.com/charlie/development/cloud/Git.html#merging-code>
